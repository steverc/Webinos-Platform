<html>
<head>
<title>Messaging API test</title>
<meta charset="utf-8"/>
<link rel="stylesheet" href="css/layout.css" type="text/css" media="screen" />
<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" />
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" ></script>
<script type="text/javascript" src="./webinos.js"></script>
 <script>
   $(document).ready(function() {
      function logMessage(msg) {
        if (msg) {
          $('#message').append('<li>' + msg + '</li>');
        }
      }

      $('#findService').bind('click', function() {
        test = {};
        recentService = null;
        $('#servicesList').empty();
	    //alert("findService messaging");
        webinos.discovery.findServices(new ServiceType('http://webinos.org/api/messaging'),
          {onFound: function () {
			//alert("findService callback ok");

            console.log("service found");
            //console.log("Service: "+service);

            test[service.serviceAddress] = service;
            $('#servicesList').append($('<option>' + service.serviceAddress + '</option>'));
          }});
		  
		  
		  
		  
		  
	    //alert("findServ 09");
      });
      $("#servicesList option").live('click', function(event) {
        $(this).parent().attr("recent", $(this).val());
      });
	  
      $('#bind').bind('click', function() {
        recentService = test[$('#servicesList').attr('recent')];
        recentService.bindService({onBind:function(service) {
          logMessage('TEST API ' + service.api + ' bound.');
        }});
      });

      $('#messaging').bind('click', function() {
      recentService.test('messaging', function(result) {
        alert(result);
      },
      function(error){
        alert(error.code + " " + error.message);
      });
      });

   });
 </script>
</head>
<body>
<section id="main" class="column">
    <article class="module width_full">
      <header><h3>Webinos PZP</h3></header>
        <div class="module_content">
          <p>Please select one of the actions on the left menu</p>
          <table>
          <tr>
	              <td>Use "Find Services" to search for available cdi-test services.<br/>
              Select one, then bind and use. Select another and bind again and use.
            </td>
            <td>
              <button id="findService" class="button">Find Services</button>
              <br />
              <select id="servicesList" size="5"></select>
            </td>
          </tr>
          <tr>
            <td><p>
                <i> The selected address means the Service at that address
                  will be used.</i>
              </p></td>
          </tr>
          <tr>
            <td>
              <button id="bind" class="button">Bind</button>
            </td>
            <td>
              <button id="messaging" class="button">Messaging</button>
            </td>
          </tr>
        </table>
      </div>
    </article>
    <div class="spacer"></div>
    <div id="status"> STATUS: <span id="message"></span></div>
  </section>
</body>
</html>
	  
	  